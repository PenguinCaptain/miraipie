<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>消息结构 | miraipie</title>
  <meta name="generator" content="VuePress 1.8.2">
  
  <meta name="description" content="miraipie文档">
  
  <link rel="preload" href="/miraipie/assets/css/0.styles.66940355.css" as="style"><link rel="preload" href="/miraipie/assets/js/app.5b0cc2b7.js" as="script"><link rel="preload" href="/miraipie/assets/js/2.0664a361.js" as="script"><link rel="preload" href="/miraipie/assets/js/15.c3bfa958.js" as="script"><link rel="prefetch" href="/miraipie/assets/js/10.a4e3d631.js"><link rel="prefetch" href="/miraipie/assets/js/11.cfe71ed7.js"><link rel="prefetch" href="/miraipie/assets/js/12.5d0618ae.js"><link rel="prefetch" href="/miraipie/assets/js/13.5b81342c.js"><link rel="prefetch" href="/miraipie/assets/js/14.d3ecb6df.js"><link rel="prefetch" href="/miraipie/assets/js/3.f46fb657.js"><link rel="prefetch" href="/miraipie/assets/js/4.cbb118a9.js"><link rel="prefetch" href="/miraipie/assets/js/5.c95e80e3.js"><link rel="prefetch" href="/miraipie/assets/js/6.d6a51e60.js"><link rel="prefetch" href="/miraipie/assets/js/7.37ec57e5.js"><link rel="prefetch" href="/miraipie/assets/js/8.1267b5e6.js"><link rel="prefetch" href="/miraipie/assets/js/9.0a80e57b.js">
  <link rel="stylesheet" href="/miraipie/assets/css/0.styles.66940355.css">
</head>
<body>
<div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/miraipie/" class="home-link router-link-active"><!----> <span class="site-name">miraipie</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://jsconsole.com/?%3Aload%20https%3A%2F%2Fcdn.jsdelivr.net%2Fnpm%2Fmiraipie%40latest%2Fdist%2Fmiraipie.bundle.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  playground
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/nepsyn/miraipie" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://jsconsole.com/?%3Aload%20https%3A%2F%2Fcdn.jsdelivr.net%2Fnpm%2Fmiraipie%40latest%2Fdist%2Fmiraipie.bundle.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  playground
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/nepsyn/miraipie" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>入门</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miraipie/about/about.html" class="sidebar-link">介绍</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>快速开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miraipie/guide/installation.html" class="sidebar-link">安装</a></li><li><a href="/miraipie/guide/preparation.html" class="sidebar-link">准备工作</a></li><li><a href="/miraipie/guide/listen.html" class="sidebar-link">启动应用</a></li><li><a href="/miraipie/guide/basic.html" class="sidebar-link">基础使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miraipie/pro/message.html" aria-current="page" class="active sidebar-link">消息结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/miraipie/pro/message.html#消息链-messagechain" class="sidebar-link">消息链（MessageChain）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/miraipie/pro/message.html#数组原生操作" class="sidebar-link">数组原生操作</a></li><li class="sidebar-sub-header"><a href="/miraipie/pro/message.html#消息过滤" class="sidebar-link">消息过滤</a></li><li class="sidebar-sub-header"><a href="/miraipie/pro/message.html#消息来源" class="sidebar-link">消息来源</a></li><li class="sidebar-sub-header"><a href="/miraipie/pro/message.html#消息序列化" class="sidebar-link">消息序列化</a></li></ul></li><li class="sidebar-sub-header"><a href="/miraipie/pro/message.html#单一消息-singlemessage" class="sidebar-link">单一消息（SingleMessage）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/miraipie/pro/message.html#消息构造" class="sidebar-link">消息构造</a></li><li class="sidebar-sub-header"><a href="/miraipie/pro/message.html#消息序列化-2" class="sidebar-link">消息序列化</a></li></ul></li></ul></li><li><a href="/miraipie/pro/events.html" class="sidebar-link">事件</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="消息结构"><a href="#消息结构" class="header-anchor">#</a> 消息结构</h1> <h2 id="消息链-messagechain"><a href="#消息链-messagechain" class="header-anchor">#</a> 消息链（<code>MessageChain</code>）</h2> <p>mirai 中的消息链相当于多个<a href="#%E5%8D%95%E4%B8%80%E6%B6%88%E6%81%AF-singlemessage">单一消息</a>（SingleMessage）的列表，
miraipie 在保持消息链原有特性的基础上对其进行了拓展，
添加了类型选取（select）、丢弃（drop）等操作，使开发过程中对消息链的操作更加直观。</p> <p>在 miraipie 中，所有发送和接收到的消息都是以消息链的形式存在的。
即使发送的消息中只有一条普通文本内容，为了保持一致性，miraipie 也会构造一个消息链来装载这条消息。</p> <blockquote><p>Tips： 在 miraipie 源码中 Mirai.MessageChain 和 MessageChain 有不同含义，
Mirai.MessageChain 表示 mirai-api-http 中的消息链类型，本质上是多个单一消息组合成的数组，
而直接使用的 MessageChain 是 miraipie 拓展后的消息链类型，其拥有更丰富的操作。</p></blockquote> <h3 id="数组原生操作"><a href="#数组原生操作" class="header-anchor">#</a> 数组原生操作</h3> <p>miraipie 中 <code>MessageChain</code> 类型本质上还是一个数组，其拥有 JS 原生数组具备的所有操作。
你可以直接使用 map 、filter 等原生操作，也可以直接使用下标获取对应单一消息。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>MessageChain<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'miraipie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 构造消息链（一般不需要手动构建，此处为演示需要）</span>
<span class="token keyword">const</span> chain <span class="token operator">=</span> MessageChain<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">Plain</span><span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">Plain</span><span class="token punctuation">(</span><span class="token string">'World!'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// {type: 'Plain', text: 'Hello '}</span>
chain<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// {type: 'Plain', text: 'World!'}</span>
chain<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 添加一个表情</span>
chain<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">Face</span><span class="token punctuation">(</span>Faces<span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3</span>
chain<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
</code></pre></div><h3 id="消息过滤"><a href="#消息过滤" class="header-anchor">#</a> 消息过滤</h3> <ul><li><code>chain.f</code> or <code>chain.firstClientMessage</code></li></ul> <p>用于获取消息链中的首条有效消息。
在 mirai-api-http 接收到的消息链中，会自动加上一个 Source 类型的单一消息用于标识消息来源。
然而实际开发中很少会直接用到，使用 <code>chain.f</code> 可以轻松过滤掉 Source 类型单一消息并返回第一个有效单一消息。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'FriendMessage'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chatMessage</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 控制台打印每条接收到好友消息的第一条有效消息</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chatMessage<span class="token punctuation">.</span>messageChain<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>chain.select(type)</code> or <code>chain.selected(type)</code></li></ul> <p>用于选择指定类型的消息。
选择后只保留指定类型的消息，<code>chain.select(type)</code> 会在 <strong>原地</strong> 修改消息链，<code>chain.selected(type)</code> 会创建一个新的消息链。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>MessageChain<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'miraipie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 构造消息链</span>
<span class="token keyword">const</span> chain <span class="token operator">=</span> MessageChain<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">Plain</span><span class="token punctuation">(</span><span class="token string">'我已经怒不可遏了'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">Face</span><span class="token punctuation">(</span>Faces<span class="token punctuation">.</span><span class="token constant">FA_NU</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> plains <span class="token operator">=</span> chain<span class="token punctuation">.</span><span class="token function">selected</span><span class="token punctuation">(</span><span class="token string">'Plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 选择 Plain 类型消息并创建新的消息链</span>
chain<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token comment">// 2</span>
plains<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token comment">// 1</span>
plains <span class="token operator">===</span> chain<span class="token punctuation">;</span>  <span class="token comment">// false</span>

<span class="token keyword">const</span> plainsInPlace <span class="token operator">=</span> chain<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'Plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 原地选择 Plain 类型消息</span>
chain<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token comment">// 1</span>
plainsInPlace<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token comment">// 1</span>
plainsInPlace <span class="token operator">===</span> chain<span class="token punctuation">;</span>  <span class="token comment">// true</span>
</code></pre></div><ul><li><code>chain.drop(type)</code> or <code>chain.dropped(type)</code></li></ul> <p>用于丢弃指定类型的消息。
丢弃后只保留其他类型消息，与消息选择类似，
<code>chain.drop(type)</code> 会在 <strong>原地</strong> 修改消息链，<code>chain.dropped(type)</code> 会创建一个新的消息链。</p> <h3 id="消息来源"><a href="#消息来源" class="header-anchor">#</a> 消息来源</h3> <ul><li><code>chain.sourceId</code></li></ul> <p>用于获取消息id。只存在于 mirai-api-http 返回的消息链中。
一般用于消息撤回等操作。</p> <ul><li><code>chain.time</code></li></ul> <p>用于获取消息接收时间。只存在于 mirai-api-http 返回的消息链中。
一般用于持久化记录消息等操作。</p> <h3 id="消息序列化"><a href="#消息序列化" class="header-anchor">#</a> 消息序列化</h3> <ul><li><code>chain.toMiraiCode()</code></li></ul> <p>用于将消息链序列化为 mirai 码。
miraipie <strong>不能保证</strong>序列化后的 mirai 码与 mirai 原生 mirai 码兼容，请谨慎使用。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>MessageChain<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'miraipie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 构造消息链</span>
<span class="token keyword">const</span> chain <span class="token operator">=</span> MessageChain<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">AtAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Plain</span><span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Plain</span><span class="token punctuation">(</span><span class="token string">'World!'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &quot;[mirai:atall] Hello World!&quot;</span>
chain<span class="token punctuation">.</span><span class="token function">toMiraiCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>chain.toDisplayString()</code></li></ul> <p>用于将消息链序列化为显示字符串。
一般用于日志记录或文本消息匹配。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>MessageChain<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'miraipie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 构造消息链</span>
<span class="token keyword">const</span> chain <span class="token operator">=</span> MessageChain<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">AtAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Plain</span><span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Plain</span><span class="token punctuation">(</span><span class="token string">'World!'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &quot;@全体成员 Hello World!&quot;</span>
chain<span class="token punctuation">.</span><span class="token function">toDisplayString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="单一消息-singlemessage"><a href="#单一消息-singlemessage" class="header-anchor">#</a> 单一消息（<code>SingleMessage</code>）</h2> <p>mirai 中的单一消息用于表示一个原子的消息内容，如一张图片、一段语音等。
在 mirai-api-http 中，单一消息使用 JSON 格式表示，miraipie 在原有基础上对其进行了简单拓展。</p> <p>miraipie 中支持的单一消息类型始终与 mirai-api-http 提供的 <a href="https://github.com/project-mirai/mirai-api-http/blob/master/docs/api/MessageType.md#%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B" target="_blank" rel="noopener noreferrer">消息类型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 保持一致。</p> <ul><li>Source （来源）</li> <li>Quote （引用回复）</li> <li>At （@某人）</li> <li>AtAll （@全体成员）</li> <li>Face （聊天表情）</li> <li>Plain （普通文本）</li> <li>Image （图片）</li> <li>FlashImage （闪图）</li> <li>Voice （语音）</li> <li>Xml （XML 卡片）</li> <li>Json（JSON 卡片）</li> <li>App （小程序）</li> <li>Poke （戳一戳）</li> <li>Dice （骰子）</li> <li>MusicShare （音乐分享）</li> <li>Forward （合并转发）</li> <li>File （文件）</li> <li>MiraiCode （原生 mirai 码）</li></ul> <h3 id="消息构造"><a href="#消息构造" class="header-anchor">#</a> 消息构造</h3> <p>在 miraipie 中，构造单一消息只需要调用其类型同名函数并依次填入参数即可。
函数具体的参数可查看 mirai-api-http 提供的 <a href="https://github.com/project-mirai/mirai-api-http/blob/master/docs/api/MessageType.md#%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B" target="_blank" rel="noopener noreferrer">消息类型文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，也可以通过 IDE 查看函数注释。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>Plain<span class="token punctuation">,</span> At<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'miraipie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// {type: 'Plain', text: 'JavaScript is the best programming language in the world!', ...}</span>
<span class="token function">Plain</span><span class="token punctuation">(</span><span class="token string">'JavaScript is the best programming language in the world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// {type: 'At', target: 123456789, display: '@', ...}</span>
<span class="token function">At</span><span class="token punctuation">(</span><span class="token number">123456789</span><span class="token punctuation">,</span> <span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>特别的，由于部分单一消息可选属性较多，miraipie 提供了一些辅助函数用于构造图片、闪图、语音和音乐分享型消息。
其分别对应 <code>makeImage(options)</code> 、 <code>makeFlashImage(options)</code> 、 <code>makeVoice(options)</code> 和 <code>makeMusicShare(options)</code> 。
使用辅助函数构造此类消息会使消息结构更为直观。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>Image<span class="token punctuation">,</span> makeImage<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'miraipie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> base64string <span class="token operator">=</span> <span class="token string">'SomeMockBase64String=='</span><span class="token punctuation">;</span>

<span class="token comment">// 直接构造方式</span>
<span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token function">Image</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> base64string<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 辅助函数构造方式</span>
<span class="token keyword">const</span> imageByMake <span class="token operator">=</span> <span class="token function">makeImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    base64<span class="token operator">:</span> base64string
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="消息序列化-2"><a href="#消息序列化-2" class="header-anchor">#</a> 消息序列化</h3> <p>与消息链相同，每个单一消息都有 <code>toMiraiCode()</code> 和 <code>toDisplayString()</code> 方法，用于分别序列化为 mirai 码和显示字符串。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>At<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'miraipie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> at <span class="token operator">=</span> <span class="token function">At</span><span class="token punctuation">(</span><span class="token number">123456789</span><span class="token punctuation">,</span> <span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [mirai:at:123456789]</span>
at<span class="token punctuation">.</span><span class="token function">toMiraiCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// @123456789</span>
at<span class="token punctuation">.</span><span class="token function">toDisplayString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/nepsyn/miraipie/edit/master/docs/pro/message.md" target="_blank" rel="noopener noreferrer">发现问题？在 Github 上帮助改善此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最近更新于:</span> <span class="time">10/11/2021, 4:30:12 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/miraipie/guide/basic.html" class="prev">
        基础使用
      </a></span> <span class="next"><a href="/miraipie/pro/events.html">
        事件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
<script src="/miraipie/assets/js/app.5b0cc2b7.js" defer></script><script src="/miraipie/assets/js/2.0664a361.js" defer></script><script src="/miraipie/assets/js/15.c3bfa958.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/miraipie@latest/dist/miraipie.bundle.js"></script>
</body>
</html>
