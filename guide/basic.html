<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>基础使用 | miraipie</title>
  <meta name="generator" content="VuePress 1.8.2">
  
  <meta name="description" content="miraipie文档">
  
  <link rel="preload" href="/miraipie/assets/css/0.styles.66940355.css" as="style"><link rel="preload" href="/miraipie/assets/js/app.5b0cc2b7.js" as="script"><link rel="preload" href="/miraipie/assets/js/2.0664a361.js" as="script"><link rel="preload" href="/miraipie/assets/js/10.a4e3d631.js" as="script"><link rel="preload" href="/miraipie/assets/js/3.f46fb657.js" as="script"><link rel="prefetch" href="/miraipie/assets/js/11.cfe71ed7.js"><link rel="prefetch" href="/miraipie/assets/js/12.5d0618ae.js"><link rel="prefetch" href="/miraipie/assets/js/13.5b81342c.js"><link rel="prefetch" href="/miraipie/assets/js/14.d3ecb6df.js"><link rel="prefetch" href="/miraipie/assets/js/15.c3bfa958.js"><link rel="prefetch" href="/miraipie/assets/js/4.cbb118a9.js"><link rel="prefetch" href="/miraipie/assets/js/5.c95e80e3.js"><link rel="prefetch" href="/miraipie/assets/js/6.d6a51e60.js"><link rel="prefetch" href="/miraipie/assets/js/7.37ec57e5.js"><link rel="prefetch" href="/miraipie/assets/js/8.1267b5e6.js"><link rel="prefetch" href="/miraipie/assets/js/9.0a80e57b.js">
  <link rel="stylesheet" href="/miraipie/assets/css/0.styles.66940355.css">
</head>
<body>
<div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/miraipie/" class="home-link router-link-active"><!----> <span class="site-name">miraipie</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://jsconsole.com/?%3Aload%20https%3A%2F%2Fcdn.jsdelivr.net%2Fnpm%2Fmiraipie%40latest%2Fdist%2Fmiraipie.bundle.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  playground
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/nepsyn/miraipie" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://jsconsole.com/?%3Aload%20https%3A%2F%2Fcdn.jsdelivr.net%2Fnpm%2Fmiraipie%40latest%2Fdist%2Fmiraipie.bundle.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  playground
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/nepsyn/miraipie" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>入门</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miraipie/about/about.html" class="sidebar-link">介绍</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>快速开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miraipie/guide/installation.html" class="sidebar-link">安装</a></li><li><a href="/miraipie/guide/preparation.html" class="sidebar-link">准备工作</a></li><li><a href="/miraipie/guide/listen.html" class="sidebar-link">启动应用</a></li><li><a href="/miraipie/guide/basic.html" aria-current="page" class="active sidebar-link">基础使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/miraipie/guide/basic.html#创建应用" class="sidebar-link">创建应用</a></li><li class="sidebar-sub-header"><a href="/miraipie/guide/basic.html#启动监听" class="sidebar-link">启动监听</a></li><li class="sidebar-sub-header"><a href="/miraipie/guide/basic.html#hello-world" class="sidebar-link">Hello World!</a></li><li class="sidebar-sub-header"><a href="/miraipie/guide/basic.html#发送不同类型消息" class="sidebar-link">发送不同类型消息</a></li><li class="sidebar-sub-header"><a href="/miraipie/guide/basic.html#响应他人的消息" class="sidebar-link">响应他人的消息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/miraipie/guide/basic.html#一次性的响应" class="sidebar-link">一次性的响应</a></li><li class="sidebar-sub-header"><a href="/miraipie/guide/basic.html#持续性的响应" class="sidebar-link">持续性的响应</a></li><li class="sidebar-sub-header"><a href="/miraipie/guide/basic.html#我该如何决定哪种响应方式" class="sidebar-link">我该如何决定哪种响应方式</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miraipie/pro/message.html" class="sidebar-link">消息结构</a></li><li><a href="/miraipie/pro/events.html" class="sidebar-link">事件</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基础使用"><a href="#基础使用" class="header-anchor">#</a> 基础使用</h1> <blockquote><p>此指南假设你已经了解 JavaScript 的相关知识，并能够使用 JavaScript 进行基础开发。
在实际使用中遇到问题时，如果是语言和技术相关的问题，建议使用搜索引擎解决你的问题。
如果是 miraipie 中产生的问题，欢迎在 Github 仓库提出 issue。</p></blockquote> <p>从文档的这一部分开始，我们强烈建议你使用本地的工具完成教程中的操作，以对 miraipie 有更加直观的理解。 如果你是熟悉 web 开发的开发者，可以使用网页调试控制台（F12 唤出）来完成教程。
如果调试控制台妨碍了你的阅读，也可以点击以下按钮弹出 jsconsole playground 来完成教程。</p> <p><a onclick="window.open('https://jsconsole.com/?%3Aload%20https%3A%2F%2Fcdn.jsdelivr.net%2Fnpm%2Fmiraipie%40latest%2Fdist%2Fmiraipie.bundle.js', 'jsconsole - playground', 'height=640,width=800,location=no,menubar=no,status=no,toolbar=no')" class="button">jsconsole playground</a></p> <p>如果你是熟悉 Node.js 的开发者——那也没关系，你可以直接启动 Node REPL 解释器完成同样的操作，你需要先新建一个 NPM 项目：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> miraipie-guide
<span class="token builtin class-name">cd</span> miraipie-guide
<span class="token function">npm</span> init -y
<span class="token function">npm</span> i miraipie
</code></pre></div><p>完成上面的操作后，在 miraipie-guide 目录下启动一个 Node REPl 解释器，并 require miraipie 到环境中：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Miraipie <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'miraipie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>至此，你可以使用解释器完成以下的所有教程内容了。</p> <h2 id="创建应用"><a href="#创建应用" class="header-anchor">#</a> 创建应用</h2> <p>在 <a href="/miraipie/guide/listen.html">启动应用</a> 一节已经了解了启动 miraipie 应用程序的方法。 在教程开始前，我们首先创建一个应用程序实例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> app <span class="token operator">=</span> Miraipie<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span>Miraipie<span class="token punctuation">.</span><span class="token function">makeAppConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    qq<span class="token operator">:</span> <span class="token number">100000000</span><span class="token punctuation">,</span>                     <span class="token comment">// 这里修改为机器人服务的QQ号</span>
    adapterInUse<span class="token operator">:</span> <span class="token string">'ws'</span><span class="token punctuation">,</span>
    verbose<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    adapters<span class="token operator">:</span> <span class="token punctuation">{</span>
        ws<span class="token operator">:</span> <span class="token punctuation">{</span>
            configs<span class="token operator">:</span> <span class="token punctuation">{</span>
                verifyKey<span class="token operator">:</span> <span class="token string">'my verify key'</span><span class="token punctuation">,</span>  <span class="token comment">// 这里修改为 mirai-api-http 的配置项 verifyKey</span>
                host<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>           <span class="token comment">// 这里修改为 mirai-api-http 服务主机地址</span>
                port<span class="token operator">:</span> <span class="token number">22333</span>                  <span class="token comment">// 这里修改为 mirai-api-http 服务端口号</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="启动监听"><a href="#启动监听" class="header-anchor">#</a> 启动监听</h2> <p>使用 CLI 创建的应用程序会自动启动监听，但在一般情况下，miraipie 是不会自动启动监听的，为此我们需要手动启动监听。 miraipie 有较为完善的事件系统，首先我们为监听成功添加一个事件监听器：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listen'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'miraipie 应用程序监听启动成功啦！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>之后我们手动启动监听：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果配置填写正确并且应用监听启动成功，你应该能在控制台看到 <code>&quot;miraipie 应用程序监听启动成功啦！&quot;</code> 。 人生难得一帆风顺，当你遇到问题导致监听未启动成功时，请检查控制台的输出内容并调整配置。</p> <blockquote><p>如果控制台出现 <code>An insecure WebSocket connection may not be initiated from a page loaded over HTTPS</code> 错误提示，请启用 <code>ssl</code> 配置或参考 <a href="https://www.damirscorner.com/blog/posts/20210528-AllowingInsecureWebsocketConnections.html" target="_blank" rel="noopener noreferrer">Allowing insecure WebSocket connections<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <h2 id="hello-world"><a href="#hello-world" class="header-anchor">#</a> Hello World!</h2> <p>和其他很多教程一样，Hello World 的示例是最直观的。 我们已经成功启动了监听，现在我们可以与好友进行聊天了！</p> <p>我们首先选择一个好友作为聊天的对象，这个好友应该存在于机器人账号的好友列表中（一般测试的情况下，建议注册一个额外的 QQ 账号用于测试），然后我们向好友发送一条消息，内容为 <code>&quot;Hello World!&quot;</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Miraipie<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span><span class="token function">findFriend</span><span class="token punctuation">(</span><span class="token comment">/* 换成好友的QQ号 */</span> <span class="token number">123456789</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">chat</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> chat<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果发送成功，效果图如下所示：</p> <div class="container" data-v-75aa4170><div class="header" data-v-75aa4170><span data-v-75aa4170>聊天记录</span></div> <div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-bot" data-v-75aa4170>Hello World!</div></div></div> <p>这里的 <code>chat</code> 是 miraipie 中抽象的一个概念，它代表与一个对象的聊天窗口。
和 QQ 客户端一样，你的聊天窗口可以分为和好友的聊天窗口、群聊的聊天窗口和私聊的聊天窗口。
聊天窗口提供了多个方法用于模拟客户端的各项操作，例如发送消息、撤回消息、删除好友等。</p> <h2 id="发送不同类型消息"><a href="#发送不同类型消息" class="header-anchor">#</a> 发送不同类型消息</h2> <p>在日常使用社交软件的过程中，我们当然不只发送文本，我们还要发送不同类型的消息。
在 miraipie 中，发送不同类型的消息非常简单。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 发送一张图片消息，以下两种方式是等价的</span>
<span class="token keyword">await</span> chat<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>Miraipie<span class="token punctuation">.</span><span class="token function">Image</span><span class="token punctuation">(</span>
    <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token string">'https://tvax1.sinaimg.cn/large/007Tv3Vmly1gufg1l5szij31hc0u07cv'</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> chat<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>Miraipie<span class="token punctuation">.</span><span class="token function">makeImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">'https://tvax1.sinaimg.cn/large/007Tv3Vmly1gufg1l5szij31hc0u07cv'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="container" data-v-75aa4170><div class="header" data-v-75aa4170><span data-v-75aa4170>聊天记录</span></div> <div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <img src="https://tvax1.sinaimg.cn/large/007Tv3Vmly1gufg1l5szij31hc0u07cv" alt="未加载的图片" class="image" data-v-75aa4170></div></div> <h2 id="响应他人的消息"><a href="#响应他人的消息" class="header-anchor">#</a> 响应他人的消息</h2> <p>作为一个机器人，其不能只是主动发送消息，在他人发送消息时做出合理响应才是机器人最核心的功能。
在 miraipie 中，针对消息做出响应分为两种：一次性的响应（等待）和持续性的响应（监听）。</p> <h3 id="一次性的响应"><a href="#一次性的响应" class="header-anchor">#</a> 一次性的响应</h3> <p>一个简单的例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 复读</span>
Miraipie<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span><span class="token function">findFriend</span><span class="token punctuation">(</span><span class="token comment">/* 换成好友的QQ号 */</span> <span class="token number">123456789</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">chat</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">await</span> chat<span class="token punctuation">.</span><span class="token function">nextMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> chat<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>之后通过该好友向机器人发送任意一条消息，就会有如下所示的响应：</p> <div class="container" data-v-75aa4170><div class="header" data-v-75aa4170><span data-v-75aa4170>聊天记录</span></div> <div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-others" data-v-75aa4170>人类的本质</div></div><div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-bot" data-v-75aa4170>人类的本质</div></div></div> <p>但只响应一次消息的复读机往往是不符合直觉的：</p> <div class="container" data-v-75aa4170><div class="header" data-v-75aa4170><span data-v-75aa4170>聊天记录</span></div> <div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-others" data-v-75aa4170>人类的本质</div></div><div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-bot" data-v-75aa4170>人类的本质</div></div><div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-others" data-v-75aa4170>你最帅！</div></div><div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-others" data-v-75aa4170>为什么不说话？</div></div></div> <h3 id="持续性的响应"><a href="#持续性的响应" class="header-anchor">#</a> 持续性的响应</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'FriendMessage'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">chatMessage</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>chatMessage<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token comment">/* 换成好友的QQ号 */</span> <span class="token number">123456789</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> chat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FriendChat</span><span class="token punctuation">(</span>chatMessage<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> chat<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>chatMessage<span class="token punctuation">.</span>messageChain<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 不创建聊天窗，直接通过api发送</span>
        <span class="token comment">// app.api.sendFriendMessage(chatMessage.sender.id, chatMessage.messageChain);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>现在你的机器人会持续性地响应指定好友发送的消息了：</p> <div class="container" data-v-75aa4170><div class="header" data-v-75aa4170><span data-v-75aa4170>聊天记录</span></div> <div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-others" data-v-75aa4170>人类的本质</div></div><div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-bot" data-v-75aa4170>人类的本质</div></div><div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-others" data-v-75aa4170>你最帅！</div></div><div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-bot" data-v-75aa4170>你最帅！</div></div><div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <img src="/miraipie/images/bro.jpg" alt="未加载的图片" class="image" data-v-75aa4170></div><div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <img src="/miraipie/images/bro.jpg" alt="未加载的图片" class="image" data-v-75aa4170></div></div> <h3 id="我该如何决定哪种响应方式"><a href="#我该如何决定哪种响应方式" class="header-anchor">#</a> 我该如何决定哪种响应方式</h3> <p>对于机器人的某个长期支持的服务（点歌、搜题等）来说，一般应采用持续响应的方式。
对于一些只作用一次的功能（抢答、确认操作等），一般采用一次性响应的方式。</p> <p>在实际开发中，通常会遇到两者组合的情况。请设想下图中的情况：</p> <div class="container" data-v-75aa4170><div class="header" data-v-75aa4170><span data-v-75aa4170>聊天记录</span></div> <div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-others" data-v-75aa4170>rm -rf /学习资料</div></div><div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-bot" data-v-75aa4170>确定要删除吗？</div></div><div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-others" data-v-75aa4170>确定</div></div><div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-bot" data-v-75aa4170>已删除</div></div><div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-others" data-v-75aa4170>rm -rf /</div></div><div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-bot" data-v-75aa4170>确定要删除吗？</div></div><div class="message" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Jerry.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-others" data-v-75aa4170>我闹着玩的</div></div><div class="message message-from-bot" data-v-75aa4170><div class="avatar-box" data-v-75aa4170><img src="/miraipie/images/Tom.jpeg" alt="未加载的头像" class="avatar" data-v-75aa4170></div> <div class="plain plain-from-bot" data-v-75aa4170>已取消删除</div></div></div> <p>对于这种长期服务操作需要确认的情况，单独使用两种响应方式都会使代码变得十分笨重。两种方式组合起来会以很优雅的方式实现功能：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'FriendMessage'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">chatMessage</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>chatMessage<span class="token punctuation">.</span>messageChain<span class="token punctuation">.</span><span class="token function">toDisplayString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'rm'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> chat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FriendChat</span><span class="token punctuation">(</span>chatMessage<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 等待下一条确认消息</span>
        <span class="token keyword">const</span> confirmMessage <span class="token operator">=</span> <span class="token keyword">await</span> chat<span class="token punctuation">.</span><span class="token function">nextMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>confirmMessage<span class="token punctuation">.</span><span class="token function">toDisplayString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'确定'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* 执行删除操作... */</span>
            <span class="token keyword">await</span> chat<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'已删除'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">/* 啥也不干 */</span>
            <span class="token keyword">await</span> chat<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'已取消删除'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>到目前为止，你已经学习了开发一个简单机器人的所有基础操作。
你现在可以倒上一杯咖啡，为你的机器人添加一个简单的功能。
在下一章节，我们将进一步探索 miraipie 中的各项操作。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/nepsyn/miraipie/edit/master/docs/guide/basic.md" target="_blank" rel="noopener noreferrer">发现问题？在 Github 上帮助改善此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最近更新于:</span> <span class="time">9/22/2021, 3:20:21 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/miraipie/guide/listen.html" class="prev">
        启动应用
      </a></span> <span class="next"><a href="/miraipie/pro/message.html">
        消息结构
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
<script src="/miraipie/assets/js/app.5b0cc2b7.js" defer></script><script src="/miraipie/assets/js/2.0664a361.js" defer></script><script src="/miraipie/assets/js/10.a4e3d631.js" defer></script><script src="/miraipie/assets/js/3.f46fb657.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/miraipie@latest/dist/miraipie.bundle.js"></script>
</body>
</html>
