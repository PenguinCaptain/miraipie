<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>启动应用 | miraipie</title>
  <meta name="generator" content="VuePress 1.8.2">
  
  <meta name="description" content="miraipie文档">
  
  <link rel="preload" href="/miraipie/assets/css/0.styles.66940355.css" as="style"><link rel="preload" href="/miraipie/assets/js/app.5b0cc2b7.js" as="script"><link rel="preload" href="/miraipie/assets/js/2.0664a361.js" as="script"><link rel="preload" href="/miraipie/assets/js/12.5d0618ae.js" as="script"><link rel="prefetch" href="/miraipie/assets/js/10.a4e3d631.js"><link rel="prefetch" href="/miraipie/assets/js/11.cfe71ed7.js"><link rel="prefetch" href="/miraipie/assets/js/13.5b81342c.js"><link rel="prefetch" href="/miraipie/assets/js/14.d3ecb6df.js"><link rel="prefetch" href="/miraipie/assets/js/15.c3bfa958.js"><link rel="prefetch" href="/miraipie/assets/js/3.f46fb657.js"><link rel="prefetch" href="/miraipie/assets/js/4.cbb118a9.js"><link rel="prefetch" href="/miraipie/assets/js/5.c95e80e3.js"><link rel="prefetch" href="/miraipie/assets/js/6.d6a51e60.js"><link rel="prefetch" href="/miraipie/assets/js/7.37ec57e5.js"><link rel="prefetch" href="/miraipie/assets/js/8.1267b5e6.js"><link rel="prefetch" href="/miraipie/assets/js/9.0a80e57b.js">
  <link rel="stylesheet" href="/miraipie/assets/css/0.styles.66940355.css">
</head>
<body>
<div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/miraipie/" class="home-link router-link-active"><!----> <span class="site-name">miraipie</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://jsconsole.com/?%3Aload%20https%3A%2F%2Fcdn.jsdelivr.net%2Fnpm%2Fmiraipie%40latest%2Fdist%2Fmiraipie.bundle.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  playground
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/nepsyn/miraipie" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://jsconsole.com/?%3Aload%20https%3A%2F%2Fcdn.jsdelivr.net%2Fnpm%2Fmiraipie%40latest%2Fdist%2Fmiraipie.bundle.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  playground
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/nepsyn/miraipie" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>入门</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miraipie/about/about.html" class="sidebar-link">介绍</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>快速开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miraipie/guide/installation.html" class="sidebar-link">安装</a></li><li><a href="/miraipie/guide/preparation.html" class="sidebar-link">准备工作</a></li><li><a href="/miraipie/guide/listen.html" aria-current="page" class="active sidebar-link">启动应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/miraipie/guide/listen.html#cli-快速启动" class="sidebar-link">CLI 快速启动</a></li><li class="sidebar-sub-header"><a href="/miraipie/guide/listen.html#通过代码启动" class="sidebar-link">通过代码启动</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/miraipie/guide/listen.html#node-js-开发者" class="sidebar-link">Node.js 开发者</a></li><li class="sidebar-sub-header"><a href="/miraipie/guide/listen.html#web-开发者" class="sidebar-link">web 开发者</a></li></ul></li></ul></li><li><a href="/miraipie/guide/basic.html" class="sidebar-link">基础使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miraipie/pro/message.html" class="sidebar-link">消息结构</a></li><li><a href="/miraipie/pro/events.html" class="sidebar-link">事件</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="启动应用"><a href="#启动应用" class="header-anchor">#</a> 启动应用</h1> <h2 id="cli-快速启动"><a href="#cli-快速启动" class="header-anchor">#</a> CLI 快速启动</h2> <p>miraipie 提供的 CLI 工具可以快速启动 miraipie 应用程序，你只需要几个简单的步骤即可运行 miraipie。 在阅读下面的步骤之前，请确保已通过 NPM 全局安装
miraipie。如果没有，请先完成<a href="/miraipie/guide/installation.html#命令行工具-cli">全局安装 miraipie</a>。</p> <p>首先为你的机器人应用程序创建一个文件夹：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> miraipie-bot
<span class="token builtin class-name">cd</span> miraipie-bot
</code></pre></div><p>其次通过命令直接启动一个机器人应用程序，首次启动时会询问部分配置：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>miraipie start
</code></pre></div><p>当然你也可以直接编写 miraipie 的配置文件。 miraipie 在启动时默认使用当前目录下 miraipie.json 文件作为应用程序配置。 你也可以通过命令参数 <code>--config &lt;path&gt;</code>
来手动指定配置文件路径，miraipie 当前只支持 json 格式的配置文件。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 手动编写配置</span>
<span class="token function">vi</span> miraipie.json
</code></pre></div><p>一个基础的配置文件内容如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;qq&quot;</span><span class="token operator">:</span> <span class="token number">10000000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;adapterInUse&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ws&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;logDirectory&quot;</span><span class="token operator">:</span> <span class="token string">&quot;log&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;logLevel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;verbose&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;adapters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;ws&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;configs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;verifyKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my verify key&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">23333</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;extensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="通过代码启动"><a href="#通过代码启动" class="header-anchor">#</a> 通过代码启动</h2> <p>如果你需要通过代码手动启动 miraipie，这也很简单。你可以直接参考 Github 仓库中提供的 <a href="https://github.com/nepsyn/miraipie/tree/master/demo" target="_blank" rel="noopener noreferrer">demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。
本节文档会提供更详细的教程，在此之前，首先确保你已经成功<a href="/miraipie/guide/installation.html">安装或引入 miraipie</a>。</p> <h3 id="node-js-开发者"><a href="#node-js-开发者" class="header-anchor">#</a> Node.js 开发者</h3> <p>你需要新建一个项目并添加 miraipie 作为依赖：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> miraipie-bot
<span class="token builtin class-name">cd</span> miraipie-bot
<span class="token function">npm</span> init
<span class="token function">npm</span> i miraipie
</code></pre></div><p>新建一个 js 脚本文件 bot.js，并添加以下内容：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>createApp<span class="token punctuation">,</span> makeAppConfig<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'miraipie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token function">makeAppConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    qq<span class="token operator">:</span> <span class="token number">100000000</span><span class="token punctuation">,</span>                          <span class="token comment">// 这里修改为机器人服务的QQ号</span>
    adapterInUse<span class="token operator">:</span> <span class="token string">'http'</span><span class="token punctuation">,</span>
    verbose<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    adapters<span class="token operator">:</span> <span class="token punctuation">{</span>
        http<span class="token operator">:</span> <span class="token punctuation">{</span>
            configs<span class="token operator">:</span> <span class="token punctuation">{</span>
                verifyKey<span class="token operator">:</span> <span class="token string">'my verify key'</span><span class="token punctuation">,</span>  <span class="token comment">// 这里修改为 mirai-api-http 的配置项 verifyKey</span>
                host<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>           <span class="token comment">// 这里修改为 mirai-api-http 服务主机地址</span>
                port<span class="token operator">:</span> <span class="token number">22333</span>                  <span class="token comment">// 这里修改为 mirai-api-http 服务端口号</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用 Node 运行该脚本文件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>node bot.js
</code></pre></div><h3 id="web-开发者"><a href="#web-开发者" class="header-anchor">#</a> web 开发者</h3> <p>web 开发者使用 miraipie 更为简单，只需要在页面中引入 miraipie 并添加如下代码：</p> <div class="language-html extra-class"><pre class="language-html"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> app <span class="token operator">=</span> Miraipie<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span>Miraipie<span class="token punctuation">.</span><span class="token function">makeAppConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    qq<span class="token operator">:</span> <span class="token number">100000000</span><span class="token punctuation">,</span>                          <span class="token comment">// 这里修改为机器人服务的QQ号</span>
    adapterInUse<span class="token operator">:</span> <span class="token string">'ws'</span><span class="token punctuation">,</span>
    verbose<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    adapters<span class="token operator">:</span> <span class="token punctuation">{</span>
      ws<span class="token operator">:</span> <span class="token punctuation">{</span>
        configs<span class="token operator">:</span> <span class="token punctuation">{</span>
          verifyKey<span class="token operator">:</span> <span class="token string">'my verify key'</span><span class="token punctuation">,</span>  <span class="token comment">// 这里修改为 mirai-api-http 的配置项 verifyKey</span>
          host<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>           <span class="token comment">// 这里修改为 mirai-api-http 服务主机地址</span>
          port<span class="token operator">:</span> <span class="token number">22333</span>                  <span class="token comment">// 这里修改为 mirai-api-http 服务端口号</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>细心的读者可能已经发现了，为什么在 Node.js 环境下配置中的 <code>adapter</code> 字段是 <code>&quot;http&quot;</code> ，而浏览器环境下是 <code>&quot;ws&quot;</code> 呢？
这是因为在浏览器条件下，浏览器会根据 <a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener noreferrer">同源策略<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 禁止非同源的 http 请求，使用 WebSocket 作为通信方式会避免遇到麻烦的跨域问题。
当然，如果读者的各项配置正确，也是可以使用 http adapter 作为通信方式的。</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/nepsyn/miraipie/edit/master/docs/guide/listen.md" target="_blank" rel="noopener noreferrer">发现问题？在 Github 上帮助改善此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最近更新于:</span> <span class="time">9/21/2021, 6:52:56 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/miraipie/guide/preparation.html" class="prev">
        准备工作
      </a></span> <span class="next"><a href="/miraipie/guide/basic.html">
        基础使用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
<script src="/miraipie/assets/js/app.5b0cc2b7.js" defer></script><script src="/miraipie/assets/js/2.0664a361.js" defer></script><script src="/miraipie/assets/js/12.5d0618ae.js" defer></script>
<script src="//cdn.jsdelivr.net/npm/miraipie@latest/dist/miraipie.bundle.js"></script>
</body>
</html>
